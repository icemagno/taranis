<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>Cesium Branco</title>
    <link href="Cesium/Widgets/widgets.css" rel="stylesheet">
    <script src="Cesium/Cesium.js"></script>
    <script src="jquery.js"></script>

    <style>
        html, body, #cesiumContainer {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;background-color: #000000;
        }
        input[type=text]{
            width: 30px;
            height: 10px;
        }
        input[type=range] {
            width: 170px;
        }
    </style>
</head>
<body>
<div style="position:relative" id="cesiumContainer"></div>
<script type="text/javascript">

	function getMapPosition3D2D( movement ){
		if ( viewer.scene.mode == Cesium.SceneMode.SCENE2D ) {
			var position = viewer.camera.pickEllipsoid(movement, scene.globe.ellipsoid);
			if (position) {
				return position;
			} 
		}
		if ( viewer.scene.mode == Cesium.SceneMode.SCENE3D ) {
			var ray = viewer.camera.getPickRay(movement);
			var position = viewer.scene.globe.pick(ray, viewer.scene);
			if (Cesium.defined(position)) {
				return position;
			} 
		}
	}


	var west = -80.72;
	var south = -37.16;
	var east = -31.14;
	var north = 11.79;	
	var homeLocation = Cesium.Rectangle.fromDegrees(west, south, east, north);        
		
	var baseOsmProvider = new Cesium.OpenStreetMapImageryProvider({
		url : 'https://a.tile.openstreetmap.org/'
	});				
	
	var viewer = new Cesium.Viewer('cesiumContainer',{
		imageryProvider: baseOsmProvider,
		timeline: false,
		skyAtmosphere: false,
		animation: false,
		fullscreenButton : false,
		
		geocoder : false,
		homeButton : false,
		infoBox : false,
		skyBox : false,
		selectionIndicator : false,
		navigationHelpButton : false,
		shouldAnimate : false,
	});
	//viewer.extend(Cesium.viewerCesium3DTilesInspectorMixin);
	var scene = viewer.scene;
	var layers = scene.imageryLayers;
	var center = Cesium.Rectangle.center( homeLocation );
	var initialPosition = Cesium.Cartesian3.fromRadians(center.longitude, center.latitude, 1150000);
	var initialOrientation = new Cesium.HeadingPitchRoll.fromDegrees(0, -90, 0);
	/*
	scene.camera.setView({
	    destination: initialPosition,
	    orientation: initialOrientation,
	    endTransform: Cesium.Matrix4.IDENTITY
	});	
	*/

	scene.globe.depthTestAgainstTerrain = true;
	
	
	scene.highDynamicRange = false;
	scene.globe.enableLighting = false;
	scene.globe.baseColor = Cesium.Color.WHITE;
	scene.screenSpaceCameraController.enableLook = false;
	scene.screenSpaceCameraController.enableCollisionDetection = true;
	scene.screenSpaceCameraController.inertiaZoom = 0;
	scene.screenSpaceCameraController.inertiaTranslate = 0;
	scene.screenSpaceCameraController.inertiaSpin = 0;
	
	//scene.globe.tileCacheSize = 250;
	//scene.pickTranslucentDepth = true;
	//scene.useDepthPicking = true;
	
	scene.globe.maximumScreenSpaceError = 1;


	$( window ).resize(function() {
	  //doTheJob();
	});
	//doTheJob();
		
	scene.camera.moveStart.addEventListener(function() { 
		mapIsMoving = true;
	});
	
	scene.camera.moveEnd.addEventListener(function() { 
		mapIsMoving = false;
		//doTheJob();
	});		
	
		
	/*********************************   **********************************************/	

	function updateTileset(tileset) {
		tileset.maximumScreenSpaceError = 1.0;
		tileset.pointCloudShading.maximumAttenuation = 0.5;
		tileset.pointCloudShading.baseResolution = 0;
		tileset.pointCloudShading.geometricErrorScale = 0.2;
		tileset.pointCloudShading.attenuation = true;
		//tileset.pointCloudShading.eyeDomeLighting = true;
		tileset.style = new Cesium.Cesium3DTileStyle({
			/*
			defines: {
				length: "length(${POSITION})"
			},
			*/
			pointSize : 3.0,
			// show: "${length} < 5000.0"
			show: "${altitude} === 0"
		});
	}

	// ========================================================
	var tileset1 = new Cesium.Cesium3DTileset({
		url: 'pointdata/2016-04-18-22-55-27/tileset.json',
		//skipLevelOfDetail : true,
	});
	var tileset2 = new Cesium.Cesium3DTileset({
		url: 'pointdata/2016-04-18-23-07-24/tileset.json',
		//skipLevelOfDetail : true,
	});
	// ========================================================
	tileset1.readyPromise.then(function(tileset) {
		console.log("T1 Pronto");
		tileset1._geometricError = 10000;
	});
	tileset2.readyPromise.then(function(tileset) {
		console.log("T2 Pronto");
		tileset2._geometricError = 10000;
		show:false;
	});
	// ========================================================
	updateTileset(tileset1);
	updateTileset(tileset2);
	// ========================================================
	viewer.scene.primitives.add(tileset1);	
	viewer.scene.primitives.add(tileset2);	
	// ========================================================


	let alti = 0;
	
	window.setTimeout(function() {
		//tileset1.show = false;
		
		window.setInterval(function() {
			if( alti > 19000 ) alti = 0;
			alti = alti + 100;
			let altiMin = alti -1;
			let altiMax = alti +1;
			
			tileset1.style = new Cesium.Cesium3DTileStyle({
				pointSize : 3.0,
				show: "${altitude} > " + altiMin + " && ${altitude} < " + altiMax
			});
			
			// tileset2.show = !tileset2.show;
			// tileset1.show = !tileset1.show;
		}, 1);
		
	},10000 );
	

	viewer.zoomTo(tileset1, new Cesium.HeadingPitchRange(0.0, -90.0, 350000.0));



		
</script>
</body>
</html>